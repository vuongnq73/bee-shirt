<!DOCTYPE html>
<html ng-app="beeShirtApp">
<head>
    <meta charset="utf-8">
    <title>Quản Lý Áo Thun</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script>
        // Khởi tạo ứng dụng AngularJS
        var app = angular.module('beeShirtApp', []);

        // Dịch vụ cho áo thun
        app.service('shirtService', ['$http', function($http) {
            const baseUrl = 'http://localhost:8080/shirts'; // Địa chỉ API

            this.getShirts = function() {
                return $http.get(baseUrl + '/api/hienthi');
            };

            this.addShirt = function(shirt) {
                return $http.post(baseUrl + '/add', shirt);
            };

            this.updateShirt = function(codeshirt, shirt) {
                return $http.put(baseUrl + '/update/' + codeshirt, shirt);
            };

            this.deleteShirt = function(codeshirt) {
                return $http.put(baseUrl + '/delete/' + codeshirt); // Ensure DELETE is called correctly
            };

            this.getShirtDetail = function(codeshirt) {
                return $http.get(baseUrl + '/detail/' + codeshirt);
            };

            // Lấy danh sách thương hiệu
            this.getBrands = function() {
                return $http.get(baseUrl + '/api/brands');
            };

            // Lấy danh sách danh mục
            this.getCategories = function() {
                return $http.get(baseUrl + '/api/categories');
            };
        }]);

        // Controller cho áo thun
        app.controller('ShirtController', ['$scope', 'shirtService', function($scope, shirtService) {
            $scope.shirts = [];
            $scope.brands = [];
            $scope.categories = [];
            $scope.newShirt = {};
            $scope.editingShirt = null;
            $scope.selectedShirtDetail = null;

            // Lấy danh sách áo thun
            $scope.getShirts = function() {
                shirtService.getShirts().then(function(response) {
                    $scope.shirts = response.data;
                });
            };

            // Lấy danh sách thương hiệu
            $scope.getBrands = function() {
                shirtService.getBrands().then(function(response) {
                    $scope.brands = response.data;
                });
            };

            // Lấy danh sách danh mục
            $scope.getCategories = function() {
                shirtService.getCategories().then(function(response) {
                    $scope.categories = response.data;
                });
            };

            // Thêm áo thun
            $scope.addShirt = function() {
                shirtService.addShirt($scope.newShirt).then(function() {
                    $scope.getShirts();
                    $scope.newShirt = {};
                });
            };

            // Chọn áo thun để sửa
            $scope.editShirt = function(shirt) {
                $scope.editingShirt = angular.copy(shirt);
            };

            // Cập nhật áo thun
            $scope.updateShirt = function() {
                shirtService.updateShirt($scope.editingShirt.codeshirt, $scope.editingShirt).then(function() {
                    $scope.getShirts();
                    $scope.editingShirt = null;
                });
            };

            // Xóa áo thun
            $scope.deleteShirt = function(codeshirt) {
                if (confirm('Bạn có chắc chắn muốn xóa áo này không?')) {
                    shirtService.deleteShirt(codeshirt).then(function() {
                        $scope.getShirts();
                    }).catch(function(error) {
                        alert('Lỗi khi xóa áo: ' + error.data.message || 'Có lỗi xảy ra.');
                    });
                }
            };

            // Xem chi tiết áo thun
            $scope.viewShirtDetail = function(codeshirt) {
                shirtService.getShirtDetail(codeshirt).then(function(response) {
                    $scope.selectedShirtDetail = response.data;
                });
            };

            // Khởi động
            $scope.getShirts();
            $scope.getBrands();
            $scope.getCategories();
        }]);
    </script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
        h1, h2 {
            text-align: center;
        }
        .detail {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body ng-controller="ShirtController">

    <h1>Danh Sách Áo Thun</h1>
    
    <table>
        <thead>
            <tr>
                <th>Mã Áo</th>
                <th>Tên Áo</th>
                <th>Thương Hiệu</th>
                <th>Danh Mục</th>
                <th>Hành Động</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="shirt in shirts">
                <td>{{ shirt.codeshirt }}</td>
                <td>{{ shirt.name }}</td>
                <td>{{ shirt.nameBrand }}</td>
                <td>{{ shirt.nameCategory }}</td>
                <td>
                    <button ng-click="editShirt(shirt)">Sửa</button>
                    <button ng-click="deleteShirt(shirt.codeshirt)">Xóa</button>
                    <button ng-click="viewShirtDetail(shirt.codeshirt)">Xem Chi Tiết</button>
                </td>
            </tr>
        </tbody>
    </table>

    <h2>Thêm Áo Thun</h2>
    <form ng-submit="addShirt()">
        <label for="codeshirt">Mã Áo:</label>
        <input type="text" id="codeshirt" ng-model="newShirt.codeshirt" required>
        
        <label for="name">Tên Áo:</label>
        <input type="text" id="name" ng-model="newShirt.name" required>
        
        <label for="brand">Thương Hiệu:</label>
        <select id="brand" ng-model="newShirt.brand.id" required>
            <option ng-repeat="brand in brands" ng-value="brand.id">{{ brand.nameBrand }}</option>
        </select>
        
        <label for="category">Danh Mục:</label>
        <select id="category" ng-model="newShirt.category.id" required>
            <option ng-repeat="category in categories" ng-value="category.id">{{ category.nameCategory }}</option>
        </select>
        
        <button type="submit">Thêm</button>
    </form>

    <h2>Sửa Áo Thun</h2>
    <form ng-submit="updateShirt()" ng-if="editingShirt">
        <label for="edit-codeshirt">Mã Áo:</label>
        <input type="text" id="edit-codeshirt" ng-model="editingShirt.codeshirt" readonly>
        
        <label for="edit-name">Tên Áo:</label>
        <input type="text" id="edit-name" ng-model="editingShirt.name" required>
        
        <label for="edit-brand">Thương Hiệu:</label>
        <select id="edit-brand" ng-model="editingShirt.brand.id" required>
            <option ng-repeat="brand in brands" ng-value="brand.id">{{ brand.nameBrand }}</option>
        </select>
        
        <label for="edit-category">Danh Mục:</label>
        <select id="edit-category" ng-model="editingShirt.category.id" required>
            <option ng-repeat="category in categories" ng-value="category.id">{{ category.nameCategory }}</option>
        </select>
        
        <button type="submit">Cập Nhật</button>
    </form>

    <div class="detail" ng-if="selectedShirtDetail">
        <h3>Chi Tiết Áo Thun</h3>
        <p>Mã Áo: {{ selectedShirtDetail.codeshirt }}</p>
        <p>Tên Áo: {{ selectedShirtDetail.name }}</p>
        <p>Thương Hiệu: {{ selectedShirtDetail.brand.nameBrand }}</p>
        <p>Danh Mục: {{ selectedShirtDetail.category.nameCategory }}</p>
        <p>Đã Xóa: {{ selectedShirtDetail.deleted }}</p>
    </div>

</body>
</html>
