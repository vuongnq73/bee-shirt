<!DOCTYPE html>
<html ng-app="beeShirtDetail">
<head>
    <title>Quản Lý Chi Tiết Áo Thun</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container mt-5" ng-controller="ShirtDetailController">
        <h2>Thêm Chi Tiết Áo Thun</h2>
        <form ng-submit="addShirtDetail()">
            <div class="mb-3">
                <label for="shirt" class="form-label">Loại Sản Phẩm:</label>
                <select id="shirt" ng-model="newShirtDetail.shirt.id" class="form-select" required>
                    <option value="" disabled selected>Chọn Sản Phẩm</option>
                    <option ng-repeat="shirt in shirts" ng-value="shirt.id">{{ shirt.nameshirt }}</option>
                </select>
            </div>

            <!-- Các input khác giống như cũ... -->

            <button type="submit" class="btn btn-primary">Thêm Chi Tiết</button>
        </form>

        <h2 class="mt-5">Danh Sách Chi Tiết Áo Thun</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã Chi Tiết</th>
                    <th>Tên Áo</th>
                    <th>Giá</th>
                    <th>Số Lượng</th>
                    <th>Màu</th>
                    <th>Giới Tính</th>
                    <th>Chất Liệu</th>
                    <th>Họa Tiết</th>
                    <th>Mùa</th>
                    <th>Xuất xứ</th>
                    <th>Kích Cỡ</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="shirtDetail in getShirtDetailsForCurrentPage()">
                    <td>{{($index + 1) + (currentPage - 1) * pageSize}}</td>
                    <td>{{shirtDetail.codeShirtDetail}}</td>
                    <td>{{shirtDetail.nameShirt}}</td>
                    <td>{{shirtDetail.price | currency}}</td>
                    <td>{{shirtDetail.quantity}}</td>
                    <td>{{shirtDetail.nameColor}}</td>
                    <td>{{shirtDetail.nameGender}}</td>
                    <td>{{shirtDetail.nameMaterial}}</td>
                    <td>{{shirtDetail.namePattern}}</td>
                    <td>{{shirtDetail.nameSeason}}</td>
                    <td>{{shirtDetail.nameOrigin}}</td>
                    <td>{{shirtDetail.nameSize}}</td>
                    <td>
                        <button type="button" class="btn btn-primary" ng-click="editShirtDetail(shirtDetail)" data-bs-toggle="modal" data-bs-target="#editShirtModal"> Sửa </button>                        
                        <button class="btn btn-danger" ng-click="deleteShirtDetail(shirtDetail.codeShirtDetail)">Xóa</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Phân trang -->
        <div class="mt-3">
            <ul class="pagination">
                <li class="page-item" ng-class="{'disabled': currentPage == 1}">
                    <a class="page-link" href="#" ng-click="currentPage = 1">&laquo;&laquo; Đầu</a>
                </li>
                <li class="page-item" ng-class="{'disabled': currentPage == 1}">
                    <a class="page-link" href="#" ng-click="currentPage = currentPage - 1">&laquo; Trước</a>
                </li>
                <li class="page-item" ng-class="{'disabled': currentPage == totalPages()}">
                    <a class="page-link" href="#" ng-click="currentPage = currentPage + 1">Tiếp &raquo;</a>
                </li>
                <li class="page-item" ng-class="{'disabled': currentPage == totalPages()}">
                    <a class="page-link" href="#" ng-click="currentPage = totalPages()">Cuối &raquo;&raquo;</a>
                </li>
            </ul>
        </div>
<!-- Modal sửa áo thun -->
<div class="modal fade" id="editShirtModal" tabindex="-1" aria-labelledby="editShirtModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="editShirtModalLabel">Sửa Áo Thun</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
            </div>
            <div class="modal-body">
              <h1 class="my-4">Sửa Áo Thun</h1>
              <form ng-submit="updateShirtDetail()">
                  <!-- Mã Áo -->
                  <div class="mb-3">
                      <label for="edit-codeshirtdetail" class="col-form-label">Mã Áo:</label>
                      <input type="text" id="edit-codeshirtdetail" ng-model="editingShirtDetail.codeShirtDetail" readonly class="form-control">
                  </div>
  
                  <!-- Sắp xếp các mục trên cùng một hàng (Giá + Số lượng) -->
                  <div class="row">
                      <!-- Giá -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-price" class="col-form-label">Giá:</label>
                          <input type="text" id="edit-price" ng-model="editingShirtDetail.price" class="form-control">
                      </div>
                      
                      <!-- Số lượng -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-quantity" class="col-form-label">Số lượng:</label>
                          <input type="text" id="edit-quantity" ng-model="editingShirtDetail.quantity" class="form-control">
                      </div>
                  </div>
  
                  <!-- Sắp xếp các mục trên cùng một hàng (Giới tính, Màu sắc) -->
                  <div class="row">
                      <!-- Giới tính -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-gender" class="col-form-label">Giới tính</label>
                          <select id="edit-gender" ng-model="editingShirtDetail.genderId" ng-options="gender.id as gender.nameGender for gender in genders" required class="form-control">
                          </select>
                      </div>
                      
                      <!-- Màu sắc -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-color" class="col-form-label">Màu sắc</label>
                          <select id="edit-color" ng-model="editingShirtDetail.colorId" ng-options="color.id as color.nameColor for color in colors" required class="form-control">
                          </select>
                      </div>
                  </div>
  
                  <!-- Các mục khác vẫn giữ nguyên -->
                  <div class="row">
                      <!-- Chất liệu -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-material" class="col-form-label">Chất liệu</label>
                          <select id="edit-material" ng-model="editingShirtDetail.materialId" ng-options="material.id as material.nameMaterial for material in materials" required class="form-control">
                          </select>
                      </div>
  
                      <!-- Kích cỡ -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-size" class="col-form-label">Kích cỡ</label>
                          <select id="edit-size" ng-model="editingShirtDetail.sizeId" ng-options="size.id as size.namesize for size in sizes" required class="form-control">
                          </select>
                      </div>
                  </div>
  
                  <!-- Các mục khác (Nguồn gốc, Mẫu áo, Mùa, Áo) -->
                  <div class="row">
                      <!-- Nguồn gốc -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-origin" class="col-form-label">Nguồn gốc</label>
                          <select id="edit-origin" ng-model="editingShirtDetail.originId" ng-options="origin.id as origin.nameOrigin for origin in origins" required class="form-control">
                          </select>
                      </div>
  
                      <!-- Mẫu áo -->
                      <div class="col-md-6 mb-3">
                          <label for="edit-pattern" class="col-form-label">Mẫu áo</label>
                          <select id="edit-pattern" ng-model="editingShirtDetail.patternId" ng-options="pattern.id as pattern.namePattern for pattern in patterns" required class="form-control">
                          </select>
                      </div>
                  </div>
  
                  <!-- Mùa -->
                  <div class="mb-3">
                      <label for="edit-season" class="col-form-label">Mùa</label>
                      <select id="edit-season" ng-model="editingShirtDetail.seasonId" ng-options="season.id as season.nameSeason for season in seasons" required class="form-control">
                      </select>
                  </div>
  
                  <!-- Áo -->
                  <div class="mb-3">
                      <label for="edit-shirt" class="col-form-label">Áo</label>
                      <select id="edit-shirt" ng-model="editingShirtDetail.shirtId" ng-options="shirt.id as shirt.nameshirt for shirt in shirts" required class="form-control">
                      </select>
                  </div>
  
                  <!-- Tình Trạng -->
                  <div class="form-group">
                      <label>Trạng Thái:</label>
                      <div>
                          <label class="custom-radio">
                              <input type="radio" ng-model="editingShirtDetail.statusshirtdetail" value="0" ng-checked="editingShirtDetail.statusshirtdetail === 0"> Còn Hàng
                          </label>
                          <label class="custom-radio">
                              <input type="radio" ng-model="editingShirtDetail.statusshirtdetail" value="1" ng-checked="editingShirtDetail.statusshirtdetail === 1"> Hết Hàng
                          </label>
                      </div>
                  </div>
  
                  <!-- Trạng Thái Xóa -->
                  <div class="form-group">
                      <label>Trạng Thái:</label>
                      <div>
                          <label class="custom-radio">
                              <input type="radio" ng-model="editingShirtDetail.deleted" value="false" ng-checked="editingShirtDetail.deleted === false"> Đang Bán
                          </label>
                          <label class="custom-radio">
                              <input type="radio" ng-model="editingShirtDetail.deleted" value="true" ng-checked="editingShirtDetail.deleted === true"> Ngừng Bán
                          </label>
                      </div>
                  </div>
  
                  <!-- Nút Cập Nhật -->
                  <div class="mb-3">
                      <button type="submit" class="btn btn-primary">Cập nhật</button>
                  </div>
              </form>
            </div>
        </div>
    </div>
  </div>
  
    </div>
     

    <script>
        var app = angular.module('beeShirtDetail', []);

        app.service('shirtDetailService', ['$http', function($http) {
            const baseUrl = 'http://localhost:8080/shirt-details';

            this.getShirtDetails = function() {
                return $http.get(baseUrl + '/api/hienthi');
            };

            this.addShirtDetail = function(shirtdetail) {
                return $http.post(baseUrl + '/add', shirtdetail);
            };

            this.updateShirtDetail = function(codeShirtDetail, shirtdetail) {
                return $http.put(baseUrl + '/update/' + codeShirtDetail, shirtdetail);
            };

            this.deleteShirtDetail = function(codeshirtdetail) {
                return $http.delete(baseUrl + '/delete/' + codeshirtdetail);
            };

            this.getColors = function() {
                return $http.get(baseUrl + '/api/colors');
            };

            this.getGenders = function() {
                return $http.get(baseUrl + '/api/genders');
            };

            this.getMaterials = function() {
                return $http.get(baseUrl + '/api/materials');
            };

            this.getOrigins = function() {
                return $http.get(baseUrl + '/api/origins');
            };

            this.getPatterns = function() {
                return $http.get(baseUrl + '/api/patterns');
            };

            this.getSeasons = function() {
                return $http.get(baseUrl + '/api/seasons');
            };

            this.getSizes = function() {
                return $http.get(baseUrl + '/api/sizes');
            };
            this.getShirts = function() {
                return $http.get(baseUrl + '/api/shirts');
            };
        }]);

        app.controller('ShirtDetailController', ['$scope', 'shirtDetailService', function($scope, shirtDetailService) {
            $scope.shirtDetails = [];
            $scope.colors = [];
            $scope.genders = [];
            $scope.materials = [];
            $scope.origins = [];
            $scope.patterns = [];
            $scope.seasons = [];
            $scope.sizes = [];
            $scope.shirts = [];

            $scope.editingShirtDetail = null; // Để lưu thông tin áo thun đang được chỉnh sửa
            $scope.newShirtDetail = {};
            $scope.currentPage = 1;
            $scope.itemsPerPage = 10;

            $scope.getShirtDetailsForCurrentPage = function() {
                const startIndex = ($scope.currentPage - 1) * $scope.itemsPerPage;
                const endIndex = startIndex + $scope.itemsPerPage;
                return $scope.shirtDetails.slice(startIndex, endIndex);
            };

            $scope.getShirtDetails = function() {
                shirtDetailService.getShirtDetails().then(function(response) {
                    $scope.shirtDetails = response.data;
                    $scope.currentPage = 1;
                });
            };

            $scope.addShirtDetail = function() {
                shirtDetailService.addShirtDetail($scope.newShirtDetail).then(function() {
                    $scope.getShirtDetails();
                    $scope.newShirtDetail = {};
                });
            };

            $scope.editShirtDetail = function(shirtDetail) {
                $scope.newShirtDetail = angular.copy(shirtDetail);
            };

            $scope.deleteShirtDetail = function(codeShirtDetail) {
                shirtDetailService.deleteShirtDetail(codeShirtDetail).then(function() {
                    $scope.getShirtDetails();
                });
            };

            $scope.getColors = function() {
                shirtDetailService.getColors().then(function(response) {
                    $scope.colors = response.data;
                });
            };

            $scope.getGenders = function() {
                shirtDetailService.getGenders().then(function(response) {
                    $scope.genders = response.data;
                });
            };

            $scope.getMaterials = function() {
                shirtDetailService.getMaterials().then(function(response) {
                    $scope.materials = response.data;
                });
            };

            $scope.getOrigins = function() {
                shirtDetailService.getOrigins().then(function(response) {
                    $scope.origins = response.data;
                });
            };

            $scope.getPatterns = function() {
                shirtDetailService.getPatterns().then(function(response) {
                    $scope.patterns = response.data;
                });
            };

            $scope.getSeasons = function() {
                shirtDetailService.getSeasons().then(function(response) {
                    $scope.seasons = response.data;
                });
            };

            $scope.getSizes = function() {
                shirtDetailService.getSizes().then(function(response) {
                    $scope.sizes = response.data;
                });
            };
            $scope.getShirts = function() {
                shirtDetailService.getShirts().then(function(response) {
                    $scope.shirts = response.data;
                });
            };
            $scope.editShirtDetail = function(shirtdetail) {
    // Sao chép đối tượng chi tiết áo thun để tránh thay đổi trực tiếp
    $scope.editingShirtDetail = angular.copy(shirtdetail);

    //chuyển dữ liệu các dropdown thuộc tính
    $scope.editingShirtDetail.colorId=$scope.editingShirtDetail.color.id;
        $scope.editingShirtDetail.genderId=$scope.editingShirtDetail.gender.id;
        $scope.editingShirtDetail.materialId=$scope.editingShirtDetail.material.id;
        $scope.editingShirtDetail.originId=$scope.editingShirtDetail.origin.id;
        $scope.editingShirtDetail.shirtId=$scope.editingShirtDetail.shirt.id;
        $scope.editingShirtDetail.patternId=$scope.editingShirtDetail.pattern.id;
        $scope.editingShirtDetail.seasonId=$scope.editingShirtDetail.season.id;
        $scope.editingShirtDetail.sizeId=$scope.editingShirtDetail.size.id;

        //các trạng thái status, deleted
        $scope.editingShirtDetail.statusshirtdetail=$scope.editingShirtDetail.statusshirtdetail;
        $scope.editingShirtDetail.deleted=$scope.editingShirtDetail.deleted;
};

       
$scope.updateShirtDetail = function() {
    // Sao chép dữ liệu từ đối tượng editShirtDetail
    let updateShirtDetailed = angular.copy($scope.editingShirtDetail);

    // Chuyển các ID thuộc tính thành đối tượng
    updateShirtDetailed.color = { id: updateShirtDetailed.colorId };
    updateShirtDetailed.gender = { id: updateShirtDetailed.genderId };
    updateShirtDetailed.material = { id: updateShirtDetailed.materialId };
    updateShirtDetailed.origin = { id: updateShirtDetailed.originId };
    updateShirtDetailed.shirt = { id: updateShirtDetailed.shirtId };
    updateShirtDetailed.pattern = { id: updateShirtDetailed.patternId };
    updateShirtDetailed.season = { id: updateShirtDetailed.seasonId };
    updateShirtDetailed.size = { id: updateShirtDetailed.sizeId };

    // Cập nhật trạng thái và đã xóa

    // Gửi yêu cầu cập nhật chi tiết áo thun
    shirtDetailService.updateShirtDetail(updateShirtDetailed.codeShirtDetail, updateShirtDetailed).then(function() {
      
        $scope.editingShirtDetail = null;
        $scope.getShirtDetails();

    }, function(error) {
        console.error("Error updating shirt", error);
    });
};


    $scope.deleteShirtDetail = function(codeShirtDetail) {
        console.log("Deleting shirt detail with code:", codeShirtDetail); // Debugging
        if (confirm('Bạn có chắc chắn muốn xóa áo này không?')) {
            shirtDetailService.deleteShirtDetail(codeShirtDetail).then(function() {
                $scope.getShirtDetails();
            }).catch(function(error) {
                alert('Có lỗi xảy ra khi xóa áo thun: ' + error.message);
            });
        }
    };
            // Initial data fetch
            $scope.getShirtDetails();
            $scope.getColors();
            $scope.getGenders();
            $scope.getMaterials();
            $scope.getPatterns();
            $scope.getSeasons();
            $scope.getOrigins();

            $scope.getSizes();
            $scope.getShirts();

        }]);

    </script>
</body>
</html>
